(function(){"use strict";importScripts("https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.js"),self.onmessage=async function(f){const{file:n,chunkSize:s}=f.data,r=new FileReader,h=e=>new Promise((o,a)=>{r.onload=()=>o(r.result),r.onerror=()=>a(r.error),r.readAsArrayBuffer(e)});try{const e=await h(n),o=new Uint8Array(e),a=CryptoJS.SHA256(CryptoJS.enc.Latin1.parse(o)).toString(),i=Math.ceil(n.size/s),u=[];for(let c=0;c<i;c++){const l=c*s,y=Math.min(l+s,n.size),p=n.slice(l,y),t=new FileReader,d=await new Promise((k,w)=>{t.onload=()=>k(t.result),t.onerror=()=>w(t.error),t.readAsArrayBuffer(p)}),A=new Uint8Array(d),S=CryptoJS.SHA256(CryptoJS.enc.Latin1.parse(A)).toString();u.push(S)}self.postMessage({fileHash:a,chunkHashes:u,totalChunks:i,chunkSize:s})}catch(e){self.postMessage({error:e.message})}}})();
