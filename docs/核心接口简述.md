# Sealock Doc 标准响应格式
```json
{
  "code": 200,      
  "data": {},       
  "message": "success"
}
```

# 关键 API 端点示例

## 块管理（Block Management）
- `POST /api/v1/blocks/check` - 检查块是否存在 (用于秒传)
- `POST /api/v1/blocks/upload` - 上传单个块
- `GET /api/v1/blocks/{hash}` - 下载块数据

## 文件操作（File Operations）
- `POST /api/v1/files/upload` - 上传文件（自动分块）
- `GET /api/v1/files/{fileHash}/download` - 下载文件
- `GET /api/v1/files/{fileHash}/metadata` - 获取文件元数据

## 库管理（Library Management）
- `POST /api/v1/libraries` - 创建库
- `GET /api/v1/libraries/{id}` - 获取库信息
- `GET /api/v1/libraries` - 列出用户的库

## 版本控制（Version Control）
- `POST /api/v1/repos/{id}/commit` - 提交文件树变更
- `GET /api/v1/repos/{id}/versions` - 列出版本历史
- `POST /api/v1/repos/{id}/rollback/{commitId}` - 版本回滚

# 后端存储配置（Backend Storage Configuration）

## 存储栈类型
| 类型 | 块存储 | 缓存 | 元数据 | 场景 |
|------|--------|------|--------|------|
| `local` | 本地内存 | ❌ | PostgreSQL | 开发 |
| `local-cached` | 本地内存 | Redis | PostgreSQL | 开发（缓存测试）|

## 环境变量配置
```bash
# 通用配置
STORAGE_TYPE=local-cached           # 存储栈类型（local 或 local-cached）
DATABASE_DSN=postgresql://...       # 数据库连接
REDIS_ADDR=localhost:6379           # Redis 地址（local-cached 时需要）
CACHE_EXPIRY=24h                    # 缓存过期时间
```

## 核心对象

### Block（块）
```go
type Block struct {
    ID       uint
    Hash     string    // SHA-256 hex (内容寻址)
    Size     int64     // 字节大小
    Data     []byte    // 实际数据（仅本地存储）
    RefCount int       // 引用计数（垃圾回收）
    CreatedAt time.Time
}
```

### File（文件）
```go
type File struct {
    ID        uint
    UUID      string         // 文件唯一标识
    Name      string         // 文件名
    Size      int64          // 文件大小
    Hash      string         // 文件 Merkle hash
    BlockIDs  []string       // 组成块的 hash 列表
    CreatedAt time.Time
}
```

### Library（库）
```go
type Library struct {
    ID               uint
    UUID             string
    Name             string
    OwnerID          uint
    CurrentVersionID uint   // HEAD 版本
    TotalSize        int64  // 统计信息
    FileCount        int
}
```

### LibraryVersion（版本）
```go
type LibraryVersion struct {
    ID              uint
    CommitID        string      // 提交 hash
    LibraryID       uint
    RootHash        string      // 目录树 hash
    Message         string      // 提交信息
    Author          string
    ParentCommits   []string    // 支持合并
    CreatedAt       time.Time
}
```
